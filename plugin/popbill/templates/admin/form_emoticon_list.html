{% extends "base.html" %}

{% block title %}
    이모티콘 관리
{% endblock %}
{% block head %}
    <link rel="stylesheet" href="/plugin/popbill/static/css/sms_style.css">


{% endblock %}
{% block subtitle %}
    이모티콘 관리
{% endblock %}

{% block content %}

<script>

function book_all_checked(chk)
{
    if (chk) {
        jQuery('[name="fo_no[]"]').attr('checked', true);
    } else {
        jQuery('[name="fo_no[]"]').attr('checked', false);
    }
}

function book_del(fo_no)
{
    if (confirm("한번 삭제한 자료는 복구할 방법이 없습니다.\n\n그래도 삭제하시겠습니까?"))
        location.href = "./form_update.php?w=d&fo_no=" + fo_no + "&page={{ request.state.page }}&fg_no={{ fg_no }}&st={{ st }}&sv={{ sv }}";
}

function multi_update(sel)
{
    var fo_no = document.getElementsByName('fo_no');
    var ck_no = '';
    var count = 0;

    if (!sel.value) {
        sel.selectedIndex = 0;
        return;
    }

    for (i=0; i<fo_no.length; i++) {
        if (fo_no[i].checked==true) {
            count++;
            ck_no += fo_no[i].value + ',';
        }
    }

    if (!count) {
        alert('하나이상 선택해주세요.');
        sel.selectedIndex = 0;
        return;
    }

    if (sel.value == 'del') {
        if (!confirm("선택한 이모티콘를 삭제합니다.\n\n비회원만 삭제됩니다.\n\n회원을 삭제하려면 회원관리 메뉴를 이용해주세요.\n\n실행하시겠습니까?"))
        {
            sel.selectedIndex = 0;
            return;
        }
    } else if (!confirm("선택한 이모티콘를 " + sel.options[sel.selectedIndex].innerHTML + "\n\n실행하시겠습니까?")) {
        sel.selectedIndex = 0;
        return;
    }

    location.href = "./form_multi_update.php?w=" + sel.value + "&ck_no=" + ck_no;
}
</script>

<div class="local_ov01 local_ov">
    <span class="btn_ov01"><span class="ov_txt">건수</span><span class="ov_num">{{ total_count }} 건</span></span>
</div>

<div class="local_sch01 local_sch sms_preset_sch">
    <form>
    <label for="fg_no" class="sound_only">그룹명</label>
    <select name="fg_no" id="fg_no" onchange="location.href='{{request.url}}?fg_no='+this.value;">
        <option value="" {{ 'selected' if fg_no else '' }} > 전체 </option>
        <option value="0" {{ 'selected' if fg_no == 0 else '' }}> 미분류 ({{ no_count }}) </option>
        {% for group in emoticon_group %}
            <option value="{{ group.fg_no }}" {{ 'selected' if fg_no == group.fg_no else "" }}>
                {{ group.fg_name }} ( {{ number_format(group.fg_count) }} )
            </option>
        {% endfor %}
    </select>
    </form>

    <form name="search_form" method="get" action="{{request.url}}">
    <input type="hidden" name="fg_no" value="{{ fg_no }}">
    <label for="st" class="sound_only">검색대상</label>
    <select name="st" id="st">
        <option value="all"{{  get_selected('all', request.state.sfl) }}>제목 + 이모티콘</option>
        <option value="name"{{  get_selected('name', request.state.sfl) }}>제목</option>
        <option value="content"{{  get_selected('content', request.state.sfl) }}>이모티콘</option>


    </select>
    <label for="sv" class="sound_only">검색어<strong class="sound_only"> 필수</strong></label>
    <input type="text" name="sv" value="{{ sv }}" id="sv" required class="frm_input required" >
    <input type="submit" value="검색" class="btn_submit">
    </form>
</div>

<div id="sms5_preset_sel">
    <input type="checkbox" id="book_all" onclick="book_all_checked(this.checked);">
    <label for="book_all">전체선택</label>
</div>


<form name="emoticonlist" id="emoticonlist" method="post" action="./form_multi_update.php" onsubmit="return emoticonlist_submit(this);" >
<input type="hidden" name="token" value="">
<input type="hidden" name="fg_no" value="{{ fg_no }}">
<input type="hidden" name="sw" value="">
<input type="hidden" name="atype" value="del">
<ul id="sms5_preset" class="sms5_box">
    {%for item in emoticon_forms %}
    <li class="li_{{ form_li_tag_id }} sms5_box">
        <span class="box_ico"></span>
        <div class="li_chk">
            <label for="fo_no_{{ loop.index0 }}" class="sound_only">{{ item.group_name }}의  {{ item['fo_name'] }}</label>
            <input type="checkbox" name="fo_no[]" value="{{ item.fo_no }}" id="fo_no_{{ loop.index0 }}>">
        </div>
        <div class="li_preview">
            <textarea readonly class="box_txt box_square">{{ item.fo_content }}</textarea>
        </div>
        <div class="li_info">
            <span class="sound_only">그룹 </span><b>{{ item.group_name }}</b><br>
            <span class="sound_only">제목 </span>{{ item.fo_name[:10] }}<br>
        </div>
        <div class="li_date">
            <span class="sound_only">등록 </span>{{ item.fo_datetime }}
        </div>
        <div class="li_cmd">
            <a href="./form_write.php?w=u&amp;fo_no={{ item.fo_no }}&amp;page={{ request.state.page }}&amp;fg_no={{ fg_no }}&amp;st={{ st }}&amp;sv={{ sv }}">수정</a>
            <a href="javascript:void(book_del('{{ item.fo_no }}'));">삭제</a>
            <a href="./sms_write?fo_no={{ item.fo_no }}">보내기</a>
        </div>
    </li>
    {% endfor %}
</ul>

<div class="btn_fixed_top" >
    <input type="submit" name="act_button" value="선택이동" onclick="document.pressed=this.value" class="btn btn_02">
    <input type="submit" name="act_button" value="선택삭제" onclick="document.pressed=this.value" class="btn btn_02">
    <a href="./form_write.php?page={{ request.state.page }}&amp;fg_no={{ fg_no }}" class="btn btn_01">이모티콘 추가</a>
</div>

</form>
{{ paging|safe }}
<script>
function emoticonlist_submit(f){
    if (!is_checked("fo_no[]")) {
        alert(document.pressed+" 하실 항목을 하나 이상 선택하세요.");
        return false;
    }
    if(document.pressed == "선택이동") {
        select_copy("move", f);
        return;
    }
    if(document.pressed == "선택삭제") {
        if(!confirm("선택한 자료를 정말 삭제하시겠습니까?")) {
            return false;
        }
    }
    return true;
}
// 선택한 이모티콘 그룹 이동
function select_copy(sw, f) {
    if( !f ){
        var f = document.emoticonlist;
    }
    if (sw == "copy")
        str = "복사";
    else
        str = "이동";

    var sub_win = window.open("", "move", "left=50, top=50, width=500, height=550, scrollbars=1");

    f.sw.value = sw;
    f.target = "move";
    f.action = "./emoticon_move.php";
    f.submit();
}
</script>

{% endblock %}